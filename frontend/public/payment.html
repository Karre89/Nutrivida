<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Your Purchase - NutriVida</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f9fafb;
            color: #333;
        }

        /* Utility Classes */
        .min-h-screen { min-height: 100vh; }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-white { background-color: white; }
        .max-w-4xl { max-width: 56rem; margin: 0 auto; }
        .max-w-md { max-width: 28rem; margin: 0 auto; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .p-6 { padding: 1.5rem; }
        .p-4 { padding: 1rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mr-3 { margin-right: 0.75rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .text-4xl { font-size: 2.25rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-xl { font-size: 1.25rem; }
        .text-lg { font-size: 1.125rem; }
        .text-sm { font-size: 0.875rem; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        .text-gray-900 { color: #111827; }
        .text-gray-700 { color: #374151; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-500 { color: #6b7280; }
        .text-green-600 { color: #16a34a; }
        .text-red-600 { color: #dc2626; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-red-50 { background-color: #fef2f2; }
        .bg-green-100 { background-color: #dcfce7; }
        .border { border: 1px solid #d1d5db; }
        .border-green-200 { border-color: #bbf7d0; }
        .border-red-200 { border-color: #fecaca; }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, 1fr); }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .gap-6 { gap: 1.5rem; }
        .gap-8 { gap: 2rem; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .space-y-6 > * + * { margin-top: 1.5rem; }
        .w-full { width: 100%; }
        .w-5 { width: 1.25rem; }
        .w-16 { width: 4rem; }
        .h-5 { height: 1.25rem; }
        .h-16 { height: 4rem; }
        .text-center { text-align: center; }
        .hidden { display: none; }
        .block { display: block; }
        .cursor-pointer { cursor: pointer; }

        /* Custom Components */
        .btn-primary {
            background: linear-gradient(135deg, #ef6820, #f28a33);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(239, 104, 32, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: white;
            color: #ef6820;
            border: 2px solid #ef6820;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-secondary:hover {
            background: #fff7ed;
        }

        /* Stripe Elements */
        .StripeElement {
            background-color: white;
            padding: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: border-color 0.2s;
        }

        .StripeElement:focus {
            border-color: #ef6820;
            outline: none;
            box-shadow: 0 0 0 2px rgba(239, 104, 32, 0.2);
        }

        .StripeElement--invalid {
            border-color: #dc2626;
        }

        /* Product card */
        .product-card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border: 1px solid #f3f4f6;
            overflow: hidden;
        }

        .product-header {
            background: linear-gradient(135deg, #ef6820, #f28a33);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .price {
            font-size: 3rem;
            font-weight: bold;
            margin: 1rem 0;
        }

        .price-subtitle {
            opacity: 0.9;
            font-size: 1.125rem;
        }

        /* Features list */
        .feature-list {
            padding: 2rem;
        }

        .feature-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
        }

        .feature-check {
            width: 1.25rem;
            height: 1.25rem;
            background-color: #16a34a;
            border-radius: 50%;
            margin-right: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ef6820;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success/Error messages */
        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .alert-success {
            background-color: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #16a34a;
        }

        .alert-error {
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
        }

        /* Responsive */
        @media (min-width: 768px) {
            .md\\:grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gray-50">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm">
            <div class="max-w-4xl mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="text-2xl font-bold" style="background: linear-gradient(135deg, #ef6820, #f28a33); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                        NutriVida
                    </div>
                    <div class="text-sm text-gray-600">
                        Secure checkout powered by Stripe
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-4xl mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Product Information -->
                <div class="product-card">
                    <div class="product-header">
                        <h1 id="product-name" class="text-2xl font-bold">7-Day Blood Sugar Reset</h1>
                        <div class="price" id="product-price">$19</div>
                        <div class="price-subtitle">One-time payment</div>
                        <div id="cultural-subtitle" class="mt-4 text-lg opacity-90">
                            Personalized Latino Meal Plan
                        </div>
                    </div>

                    <div class="feature-list">
                        <h3 class="font-semibold text-gray-900 mb-4">What's Included:</h3>
                        <div id="product-features" class="space-y-2">
                            <!-- Features will be populated by JavaScript -->
                        </div>

                        <div class="mt-6 p-4 bg-green-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-5 h-5 text-green-600 mr-3">üõ°Ô∏è</div>
                                <div>
                                    <div class="font-medium text-green-800">30-Day Money Back Guarantee</div>
                                    <div class="text-sm text-green-600">Not satisfied? Get a full refund within 30 days.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Form -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">Complete Your Purchase</h2>

                    <!-- Success Message -->
                    <div id="success-message" class="alert alert-success hidden">
                        <div class="flex items-center">
                            <div class="w-5 h-5 mr-3">‚úÖ</div>
                            <div>
                                <div class="font-medium">Payment Successful!</div>
                                <div class="text-sm">Redirecting to your dashboard...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Error Message -->
                    <div id="error-message" class="alert alert-error hidden">
                        <div class="flex items-center">
                            <div class="w-5 h-5 mr-3">‚ùå</div>
                            <div id="error-text">An error occurred processing your payment.</div>
                        </div>
                    </div>

                    <!-- Payment Form -->
                    <form id="payment-form">
                        <!-- Email -->
                        <div class="mb-4">
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                                Email Address
                            </label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email" 
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                                placeholder="your.email@example.com"
                            />
                        </div>

                        <!-- Card Element -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Card Information
                            </label>
                            <div id="card-element" class="StripeElement">
                                <!-- Stripe Elements will create input here -->
                            </div>
                            <div id="card-errors" class="text-red-600 text-sm mt-2"></div>
                        </div>

                        <!-- Order Summary -->
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                            <h3 class="font-medium text-gray-900 mb-3">Order Summary</h3>
                            <div class="flex justify-between items-center">
                                <span id="summary-product-name">7-Day Blood Sugar Reset</span>
                                <span id="summary-price" class="font-semibold">$19.00</span>
                            </div>
                            <div class="border-t border-gray-200 mt-3 pt-3">
                                <div class="flex justify-between items-center font-semibold">
                                    <span>Total</span>
                                    <span id="total-price">$19.00</span>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <button 
                            type="submit" 
                            id="submit-button" 
                            class="btn-primary"
                            disabled
                        >
                            <span id="button-text">Complete Purchase</span>
                        </button>

                        <!-- Security Notice -->
                        <div class="mt-4 text-center text-sm text-gray-500">
                            <div class="flex items-center justify-center">
                                <div class="w-4 h-4 mr-2">üîí</div>
                                Secured by SSL encryption. Your payment information is safe.
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Initialize Stripe (use test key for development)
        const stripe = Stripe('pk_test_your_publishable_key_here'); // Replace with actual key
        const elements = stripe.elements();

        // Product configuration
        const PRODUCTS = {
            'blood-sugar-reset': {
                name: '7-Day Blood Sugar Reset',
                price: 19.00,
                description: 'Culturally-adapted 7-day meal plan to help stabilize blood sugar levels',
                features: [
                    '7-day personalized meal plan',
                    'Cultural recipe adaptations',
                    'Shopping list and prep guides',
                    'Nutrition tracking dashboard',
                    'Email support'
                ]
            }
        };

        // Global variables
        let currentProduct = 'blood-sugar-reset';
        let selectedCulture = 'latino';
        let cardElement = null;
        let paymentProcessing = false;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            setupStripe();
        });

        function initializePage() {
            // Get selected culture from localStorage
            selectedCulture = localStorage.getItem('selectedCulture') || 'latino';
            
            // Get product from URL params or default
            const urlParams = new URLSearchParams(window.location.search);
            currentProduct = urlParams.get('product') || 'blood-sugar-reset';

            // Update product information
            updateProductDisplay();

            // Pre-fill email if available
            const savedEmail = localStorage.getItem('userEmail');
            if (savedEmail) {
                document.getElementById('email').value = savedEmail;
            }
        }

        function updateProductDisplay() {
            const product = PRODUCTS[currentProduct];
            if (!product) return;

            const cultureNames = {
                'latino': 'Latino',
                'somali': 'Somali',
                'south_asian': 'South Asian',
                'mediterranean': 'Mediterranean',
                'caribbean': 'Caribbean',
                'middle_eastern': 'Middle Eastern'
            };

            const cultureName = cultureNames[selectedCulture] || 'Cultural';

            // Update product info
            document.getElementById('product-name').textContent = product.name;
            document.getElementById('product-price').textContent = `$${product.price.toFixed(2)}`;
            document.getElementById('cultural-subtitle').textContent = `Personalized ${cultureName} Meal Plan`;

            // Update features
            const featuresContainer = document.getElementById('product-features');
            featuresContainer.innerHTML = product.features.map(feature => `
                <div class="feature-item">
                    <div class="feature-check">‚úì</div>
                    <span class="text-gray-700">${feature}</span>
                </div>
            `).join('');

            // Update order summary
            document.getElementById('summary-product-name').textContent = product.name;
            document.getElementById('summary-price').textContent = `$${product.price.toFixed(2)}`;
            document.getElementById('total-price').textContent = `$${product.price.toFixed(2)}`;
        }

        function setupStripe() {
            // Create card element
            cardElement = elements.create('card', {
                style: {
                    base: {
                        fontSize: '16px',
                        color: '#424770',
                        '::placeholder': {
                            color: '#aab7c4',
                        },
                    },
                },
            });

            cardElement.mount('#card-element');

            // Handle card element changes
            cardElement.on('change', function(event) {
                const displayError = document.getElementById('card-errors');
                if (event.error) {
                    displayError.textContent = event.error.message;
                } else {
                    displayError.textContent = '';
                }

                // Enable/disable submit button
                const submitButton = document.getElementById('submit-button');
                const email = document.getElementById('email').value;
                
                if (event.complete && email) {
                    submitButton.disabled = false;
                } else {
                    submitButton.disabled = true;
                }
            });

            // Handle email changes
            document.getElementById('email').addEventListener('input', function(e) {
                const submitButton = document.getElementById('submit-button');
                const email = e.target.value;
                
                if (email && email.includes('@')) {
                    submitButton.disabled = false;
                } else {
                    submitButton.disabled = true;
                }
            });

            // Handle form submission
            document.getElementById('payment-form').addEventListener('submit', handlePayment);
        }

        async function handlePayment(event) {
            event.preventDefault();

            if (paymentProcessing) return;
            paymentProcessing = true;

            const submitButton = document.getElementById('submit-button');
            const buttonText = document.getElementById('button-text');
            
            // Update button state
            submitButton.disabled = true;
            buttonText.innerHTML = '<div class="spinner"></div> Processing...';

            try {
                // Get form data
                const email = document.getElementById('email').value;
                const product = PRODUCTS[currentProduct];

                // Save email for later use
                localStorage.setItem('userEmail', email);

                // For demo purposes, simulate payment success
                // In production, you would:
                // 1. Create payment intent on your server
                // 2. Confirm payment with Stripe
                // 3. Handle success/error

                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Simulate successful payment
                showSuccess();
                
                // Redirect to dashboard after success
                setTimeout(() => {
                    window.location.href = './dashboard.html';
                }, 2000);

            } catch (error) {
                console.error('Payment error:', error);
                showError('Payment failed. Please try again.');
            } finally {
                paymentProcessing = false;
                submitButton.disabled = false;
                buttonText.textContent = 'Complete Purchase';
            }
        }

        function showSuccess() {
            document.getElementById('success-message').classList.remove('hidden');
            document.getElementById('error-message').classList.add('hidden');
            document.getElementById('payment-form').style.opacity = '0.5';
        }

        function showError(message) {
            document.getElementById('error-text').textContent = message;
            document.getElementById('error-message').classList.remove('hidden');
            document.getElementById('success-message').classList.add('hidden');
        }

        // Real Stripe integration (commented out for demo)
        /*
        async function createPaymentIntent(email, productId) {
            const response = await fetch('/api/payments/create-payment-intent', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${getAuthToken()}`
                },
                body: JSON.stringify({
                    productId,
                    culturalBackground: selectedCulture,
                    email
                })
            });

            if (!response.ok) {
                throw new Error('Failed to create payment intent');
            }

            return response.json();
        }

        async function confirmPayment(clientSecret) {
            const { error, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
                payment_method: {
                    card: cardElement,
                    billing_details: {
                        email: document.getElementById('email').value,
                    },
                }
            });

            if (error) {
                throw error;
            }

            return paymentIntent;
        }
        */
    </script>
</body>
</html>