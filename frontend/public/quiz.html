<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cultural Health Assessment - NutriVida</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Import the same CSS styles from index.css */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f9fafb;
        }

        .min-h-screen { min-height: 100vh; }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-white { background-color: white; }
        .max-w-3xl { max-width: 48rem; margin: 0 auto; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .p-8 { padding: 2rem; }
        .p-4 { padding: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mr-2 { margin-right: 0.5rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-full { border-radius: 50%; }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        .text-center { text-align: center; }
        .text-3xl { font-size: 1.875rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-xl { font-size: 1.25rem; }
        .text-lg { font-size: 1.125rem; }
        .text-sm { font-size: 0.875rem; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        .text-gray-900 { color: #111827; }
        .text-gray-800 { color: #1f2937; }
        .text-gray-700 { color: #374151; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-400 { color: #9ca3af; }
        .text-white { color: white; }
        .text-orange-600 { color: #ea580c; }
        .text-red-600 { color: #dc2626; }
        .text-green-600 { color: #16a34a; }
        .w-full { width: 100%; }
        .w-16 { width: 4rem; }
        .w-8 { width: 2rem; }
        .w-5 { width: 1.25rem; }
        .w-12 { width: 3rem; }
        .w-3 { width: 0.75rem; }
        .h-2 { height: 0.5rem; }
        .h-16 { height: 4rem; }
        .h-8 { height: 2rem; }
        .h-5 { height: 1.25rem; }
        .h-12 { height: 3rem; }
        .h-3 { height: 0.75rem; }
        .h-full { height: 100%; }
        .flex { display: flex; }
        .block { display: block; }
        .hidden { display: none; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .flex-1 { flex: 1 1 0%; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .space-x-2 > * + * { margin-left: 0.5rem; }
        .border { border: 1px solid #d1d5db; }
        .border-2 { border: 2px solid #d1d5db; }
        .border-gray-200 { border-color: #e5e7eb; }
        .border-gray-300 { border-color: #d1d5db; }
        .border-orange-500 { border-color: #f97316; }
        .border-red-200 { border-color: #fecaca; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-gray-200 { background-color: #e5e7eb; }
        .bg-gray-300 { background-color: #d1d5db; }
        .bg-orange-50 { background-color: #fff7ed; }
        .bg-orange-500 { background-color: #f97316; }
        .bg-green-100 { background-color: #dcfce7; }
        .bg-green-600 { background-color: #16a34a; }
        .bg-red-50 { background-color: #fef2f2; }
        .hover\\:border-gray-300:hover { border-color: #d1d5db; }
        .hover\\:border-gray-400:hover { border-color: #9ca3af; }
        .hover\\:bg-gray-300:hover { background-color: #d1d5db; }
        .focus\\:outline-none:focus { outline: 2px solid transparent; outline-offset: 2px; }
        .focus\\:ring-2:focus { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000); }
        .focus\\:ring-orange-500:focus { --tw-ring-color: #f97316; }
        .focus\\:border-transparent:focus { border-color: transparent; }
        .cursor-pointer { cursor: pointer; }
        .cursor-not-allowed { cursor: not-allowed; }
        .transition-all { transition: all 0.2s; }
        .transform { transform: translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }
        .scale-50 { --tw-scale-x: .5; --tw-scale-y: .5; }
        .hover\\:scale-105:hover { --tw-scale-x: 1.05; --tw-scale-y: 1.05; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }

        /* Button Styles */
        .btn-primary {
            background: linear-gradient(135deg, #ef6820, #f28a33);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(239, 104, 32, 0.3);
        }

        /* Progress Bar */
        .progress-bar {
            background: linear-gradient(135deg, #f97316, #ea580c);
            height: 0.5rem;
            border-radius: 9999px;
            transition: all 0.3s;
        }

        /* Radio Button Styles */
        .radio-dot {
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            border: 2px solid #d1d5db;
            position: relative;
        }

        .radio-dot.selected {
            border-color: #f97316;
            background-color: #f97316;
        }

        .radio-dot.selected::after {
            content: '';
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: white;
            transform: scale(0.5);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.5);
        }

        /* Checkbox Styles */
        .checkbox {
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 0.25rem;
            border: 2px solid #d1d5db;
            position: relative;
        }

        .checkbox.selected {
            border-color: #f97316;
            background-color: #f97316;
        }

        .checkbox.selected::after {
            content: 'âœ“';
            color: white;
            font-size: 0.75rem;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Scale buttons */
        .scale-button {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            border: 2px solid #d1d5db;
            font-weight: 600;
            transition: all 0.2s;
            background: white;
            color: #6b7280;
        }

        .scale-button.selected {
            border-color: #f97316;
            background-color: #f97316;
            color: white;
        }

        .scale-button:hover {
            border-color: #9ca3af;
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ef6820;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Input field */
        input[type="email"] {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            transition: all 0.2s;
        }

        input[type="email"]:focus {
            outline: none;
            border-color: #f97316;
            box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.2);
        }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gray-50">
        <!-- Progress Bar -->
        <div class="bg-white shadow-sm">
            <div class="max-w-3xl mx-auto px-4 py-4">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium text-gray-600" id="step-indicator">
                        Step 1 of 9
                    </span>
                    <span class="text-sm font-medium text-gray-600" id="progress-percent">
                        11% Complete
                    </span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="progress-bar" class="progress-bar" style="width: 11%"></div>
                </div>
            </div>
        </div>

        <!-- Quiz Content -->
        <div class="max-w-3xl mx-auto px-4 py-8">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <!-- Step Header -->
                <div class="text-center mb-8">
                    <h1 id="step-title" class="text-3xl font-bold text-gray-900 mb-2">
                        Get Your Personalized Plan
                    </h1>
                    <p id="step-subtitle" class="text-lg text-gray-600">
                        Let's start with your contact information
                    </p>
                </div>

                <!-- Question -->
                <div class="mb-8">
                    <h2 id="question" class="text-xl font-semibold text-gray-800 mb-6">
                        What's your email address?
                    </h2>

                    <!-- Quiz Content Container -->
                    <div id="quiz-content">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Error Message -->
                <div id="error-message" class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg hidden">
                    <p class="text-red-600" id="error-text"></p>
                </div>

                <!-- Navigation Buttons -->
                <div class="flex justify-between">
                    <button id="prev-btn" class="px-6 py-3 rounded-lg font-medium transition-all bg-gray-100 text-gray-400 cursor-not-allowed" disabled>
                        Previous
                    </button>

                    <button id="next-btn" class="px-6 py-3 rounded-lg font-medium transition-all btn-primary">
                        Next
                    </button>
                </div>
            </div>
        </div>

        <!-- Success Modal -->
        <div id="success-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 hidden">
            <div class="max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Thank You!</h2>
                <p class="text-gray-600 mb-6" id="success-message">
                    Your personalized meal plan is being created. Check your email for your cultural health assessment results and next steps.
                </p>
                <button onclick="goToDashboard()" class="btn-primary w-full py-3 text-lg">
                    View Your Dashboard
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 0;
        let answers = {};
        let isSubmitting = false;

        // Pre-populate culture if selected from landing page
        const selectedCulture = localStorage.getItem('selectedCulture');
        if (selectedCulture) {
            answers.cultural_background = selectedCulture;
        }

        const quizSteps = [
            {
                id: 'email',
                title: 'Get Your Personalized Plan',
                subtitle: 'Let\'s start with your contact information',
                type: 'input',
                question: 'What\'s your email address?',
                required: true
            },
            {
                id: 'cultural_background',
                title: 'Your Cultural Heritage',
                subtitle: 'We honor your cultural food traditions',
                type: 'single',
                question: 'Which cultural background best represents your heritage?',
                options: [
                    { value: 'latino', label: 'Latino/Hispanic', description: 'Mexican, Central/South American cuisines' },
                    { value: 'somali', label: 'Somali/East African', description: 'Traditional East African dishes' },
                    { value: 'south_asian', label: 'South Asian', description: 'Indian, Pakistani, Bengali cuisines' },
                    { value: 'mediterranean', label: 'Mediterranean', description: 'Greek, Italian, Middle Eastern' },
                    { value: 'caribbean', label: 'Caribbean', description: 'Jamaican, Haitian, Puerto Rican' },
                    { value: 'middle_eastern', label: 'Middle Eastern', description: 'Lebanese, Syrian, Persian cuisines' }
                ],
                required: true
            },
            {
                id: 'primary_goal',
                title: 'Your Health Goals',
                subtitle: 'What\'s most important to you right now?',
                type: 'single',
                question: 'What is your primary health goal?',
                options: [
                    { value: 'blood_sugar', label: 'Better Blood Sugar Control', description: 'Stabilize energy and reduce spikes' },
                    { value: 'weight_loss', label: 'Healthy Weight Loss', description: 'Lose weight while honoring culture' },
                    { value: 'energy', label: 'More Energy', description: 'Feel energized throughout the day' },
                    { value: 'digestion', label: 'Better Digestion', description: 'Improve gut health naturally' },
                    { value: 'family_health', label: 'Family Wellness', description: 'Healthy meals for the whole family' }
                ],
                required: true
            },
            {
                id: 'current_challenges',
                title: 'Current Challenges',
                subtitle: 'Help us understand your situation',
                type: 'multiple',
                question: 'What challenges are you facing? (Select all that apply)',
                options: [
                    { value: 'time', label: 'Not enough time to cook' },
                    { value: 'knowledge', label: 'Don\'t know which foods are healthy' },
                    { value: 'cultural_conflict', label: 'Healthy eating conflicts with cultural foods' },
                    { value: 'family_resistance', label: 'Family doesn\'t like healthy changes' },
                    { value: 'cost', label: 'Healthy foods are too expensive' },
                    { value: 'cravings', label: 'Hard to control cravings' },
                    { value: 'consistency', label: 'Struggling to stay consistent' }
                ]
            },
            {
                id: 'cooking_experience',
                title: 'Cooking Experience',
                subtitle: 'We\'ll match recipes to your skill level',
                type: 'single',
                question: 'How would you describe your cooking experience?',
                options: [
                    { value: 'beginner', label: 'Beginner', description: 'Basic cooking skills, simple recipes' },
                    { value: 'intermediate', label: 'Intermediate', description: 'Comfortable with most techniques' },
                    { value: 'advanced', label: 'Advanced', description: 'Experienced cook, enjoy complex recipes' },
                    { value: 'expert', label: 'Expert', description: 'Professional level cooking skills' }
                ],
                required: true
            },
            {
                id: 'meal_prep_time',
                title: 'Time Available',
                subtitle: 'How much time can you dedicate to cooking?',
                type: 'single',
                question: 'How much time do you typically have for meal preparation?',
                options: [
                    { value: '15', label: '15 minutes or less', description: 'Quick and simple meals' },
                    { value: '30', label: '15-30 minutes', description: 'Moderate preparation time' },
                    { value: '45', label: '30-45 minutes', description: 'Can spend time on cooking' },
                    { value: '60+', label: '45+ minutes', description: 'Love to cook, no time constraints' }
                ],
                required: true
            },
            {
                id: 'family_size',
                title: 'Household Size',
                subtitle: 'We\'ll adjust portions accordingly',
                type: 'single',
                question: 'How many people are you typically cooking for?',
                options: [
                    { value: '1', label: 'Just myself' },
                    { value: '2', label: '2 people' },
                    { value: '3-4', label: '3-4 people' },
                    { value: '5+', label: '5 or more people' }
                ],
                required: true
            },
            {
                id: 'dietary_restrictions',
                title: 'Dietary Considerations',
                subtitle: 'Any restrictions we should know about?',
                type: 'multiple',
                question: 'Do you have any dietary restrictions or preferences?',
                options: [
                    { value: 'vegetarian', label: 'Vegetarian' },
                    { value: 'vegan', label: 'Vegan' },
                    { value: 'gluten_free', label: 'Gluten-free' },
                    { value: 'dairy_free', label: 'Dairy-free' },
                    { value: 'low_sodium', label: 'Low sodium' },
                    { value: 'diabetic', label: 'Diabetic diet' },
                    { value: 'halal', label: 'Halal' },
                    { value: 'kosher', label: 'Kosher' },
                    { value: 'none', label: 'No restrictions' }
                ]
            },
            {
                id: 'motivation_level',
                title: 'Motivation Assessment',
                subtitle: 'How ready are you to make changes?',
                type: 'scale',
                question: 'On a scale of 1-10, how motivated are you to improve your health?',
                min: 1,
                max: 10,
                required: true
            }
        ];

        function updateProgress() {
            const progress = ((currentStep + 1) / quizSteps.length) * 100;
            document.getElementById('step-indicator').textContent = `Step ${currentStep + 1} of ${quizSteps.length}`;
            document.getElementById('progress-percent').textContent = `${Math.round(progress)}% Complete`;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function updateStepContent() {
            const step = quizSteps[currentStep];
            document.getElementById('step-title').textContent = step.title;
            document.getElementById('step-subtitle').textContent = step.subtitle || '';
            document.getElementById('question').textContent = step.question;

            const content = document.getElementById('quiz-content');
            content.innerHTML = '';

            if (step.type === 'input') {
                content.innerHTML = `
                    <input type="email" 
                           value="${answers[step.id] || ''}" 
                           onchange="handleAnswer('${step.id}', this.value)"
                           placeholder="your.email@example.com">
                `;
            } else if (step.type === 'single' && step.options) {
                const optionsHtml = step.options.map(option => `
                    <label class="block p-4 border-2 rounded-lg cursor-pointer transition-all ${
                        answers[step.id] === option.value ? 'border-orange-500 bg-orange-50' : 'border-gray-200 hover:border-gray-300'
                    }"
                           onclick="handleAnswer('${step.id}', '${option.value}')">
                        <div class="flex items-center">
                            <div class="flex-1">
                                <div class="font-medium text-gray-900">${option.label}</div>
                                ${option.description ? `<div class="text-sm text-gray-600 mt-1">${option.description}</div>` : ''}
                            </div>
                            <div class="radio-dot ${answers[step.id] === option.value ? 'selected' : ''}"></div>
                        </div>
                    </label>
                `).join('');
                content.innerHTML = `<div class="space-y-3">${optionsHtml}</div>`;
            } else if (step.type === 'multiple' && step.options) {
                const currentAnswers = answers[step.id] || [];
                const optionsHtml = step.options.map(option => `
                    <label class="block p-4 border-2 rounded-lg cursor-pointer transition-all ${
                        currentAnswers.includes(option.value) ? 'border-orange-500 bg-orange-50' : 'border-gray-200 hover:border-gray-300'
                    }"
                           onclick="handleMultipleAnswer('${step.id}', '${option.value}')">
                        <div class="flex items-center">
                            <div class="flex-1">
                                <div class="font-medium text-gray-900">${option.label}</div>
                                ${option.description ? `<div class="text-sm text-gray-600 mt-1">${option.description}</div>` : ''}
                            </div>
                            <div class="checkbox ${currentAnswers.includes(option.value) ? 'selected' : ''}"></div>
                        </div>
                    </label>
                `).join('');
                content.innerHTML = `<div class="space-y-3">${optionsHtml}</div>`;
            } else if (step.type === 'scale') {
                const scaleHtml = Array.from({ length: 10 }, (_, i) => i + 1).map(num => `
                    <button class="scale-button ${answers[step.id] === num ? 'selected' : ''}"
                            onclick="handleAnswer('${step.id}', ${num})"
                            type="button">
                        ${num}
                    </button>
                `).join('');
                content.innerHTML = `
                    <div class="space-y-4">
                        <div class="flex justify-between text-sm text-gray-600">
                            <span>Not motivated</span>
                            <span>Extremely motivated</span>
                        </div>
                        <div class="flex space-x-2">${scaleHtml}</div>
                    </div>
                `;
            }
        }

        function handleAnswer(stepId, value) {
            answers[stepId] = value;
            updateStepContent();
            updateNextButton();
        }

        function handleMultipleAnswer(stepId, value) {
            const currentAnswers = answers[stepId] || [];
            if (currentAnswers.includes(value)) {
                answers[stepId] = currentAnswers.filter(v => v !== value);
            } else {
                answers[stepId] = [...currentAnswers, value];
            }
            updateStepContent();
            updateNextButton();
        }

        function canProceed() {
            const step = quizSteps[currentStep];
            const answer = answers[step.id];
            if (step.required) {
                if (step.type === 'multiple') {
                    return answer && answer.length > 0;
                }
                return answer !== undefined && answer !== '';
            }
            return true;
        }

        function updateNextButton() {
            const nextBtn = document.getElementById('next-btn');
            const canMove = canProceed();
            
            if (canMove && !isSubmitting) {
                nextBtn.disabled = false;
                nextBtn.className = 'px-6 py-3 rounded-lg font-medium transition-all btn-primary hover:transform hover:scale-105';
            } else {
                nextBtn.disabled = true;
                nextBtn.className = 'px-6 py-3 rounded-lg font-medium transition-all bg-gray-300 text-gray-500 cursor-not-allowed';
            }

            // Update button text
            if (isSubmitting) {
                nextBtn.innerHTML = `
                    <div class="flex items-center">
                        <div class="spinner mr-2"></div>
                        Submitting...
                    </div>
                `;
            } else if (currentStep === quizSteps.length - 1) {
                nextBtn.textContent = 'Get My Plan';
            } else {
                nextBtn.textContent = 'Next';
            }
        }

        function updatePrevButton() {
            const prevBtn = document.getElementById('prev-btn');
            if (currentStep === 0) {
                prevBtn.disabled = true;
                prevBtn.className = 'px-6 py-3 rounded-lg font-medium transition-all bg-gray-100 text-gray-400 cursor-not-allowed';
            } else {
                prevBtn.disabled = false;
                prevBtn.className = 'px-6 py-3 rounded-lg font-medium transition-all bg-gray-200 text-gray-700 hover:bg-gray-300';
            }
        }

        function nextStep() {
            if (!canProceed() || isSubmitting) return;

            if (currentStep < quizSteps.length - 1) {
                currentStep++;
                updateProgress();
                updateStepContent();
                updateNextButton();
                updatePrevButton();
            } else {
                submitQuiz();
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateProgress();
                updateStepContent();
                updateNextButton();
                updatePrevButton();
            }
        }

        async function submitQuiz() {
            isSubmitting = true;
            updateNextButton();
            hideError();

            try {
                const quizData = {
                    email: answers.email,
                    culturalBackground: answers.cultural_background,
                    primaryGoal: answers.primary_goal,
                    responses: answers,
                    utmSource: new URLSearchParams(window.location.search).get('utm_source') || undefined,
                    utmMedium: new URLSearchParams(window.location.search).get('utm_medium') || undefined,
                    utmCampaign: new URLSearchParams(window.location.search).get('utm_campaign') || undefined,
                    referrer: document.referrer || undefined
                };

                // Simulate API call for demo
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Show success modal
                const cultureName = getCultureDisplayName(answers.cultural_background);
                document.getElementById('success-message').textContent = 
                    `Your personalized ${cultureName} meal plan is being created. Check your email for your cultural health assessment results and next steps.`;
                document.getElementById('success-modal').classList.remove('hidden');
                
                console.log('Quiz submitted:', quizData);
            } catch (error) {
                showError('Failed to submit quiz. Please try again.');
                console.error('Error submitting quiz:', error);
            } finally {
                isSubmitting = false;
                updateNextButton();
            }
        }

        function getCultureDisplayName(cultureId) {
            const cultureNames = {
                'latino': 'Latino',
                'somali': 'Somali',
                'south_asian': 'South Asian',
                'mediterranean': 'Mediterranean',
                'caribbean': 'Caribbean',
                'middle_eastern': 'Middle Eastern'
            };
            return cultureNames[cultureId] || 'cultural';
        }

        function showError(message) {
            document.getElementById('error-text').textContent = message;
            document.getElementById('error-message').classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('error-message').classList.add('hidden');
        }

        function goToDashboard() {
            window.location.href = './dashboard.html';
        }

        // Event listeners
        document.getElementById('next-btn').addEventListener('click', nextStep);
        document.getElementById('prev-btn').addEventListener('click', prevStep);

        // Initialize
        updateProgress();
        updateStepContent();
        updateNextButton();
        updatePrevButton();

        // If cultural background is pre-selected, skip to next step
        if (selectedCulture && currentStep === 1) {
            // Move to step 2 if culture is already selected
            setTimeout(() => {
                currentStep = 1; // Skip culture selection
                updateProgress();
                updateStepContent();
                updateNextButton();
                updatePrevButton();
            }, 100);
        }
    </script>
</body>
</html>